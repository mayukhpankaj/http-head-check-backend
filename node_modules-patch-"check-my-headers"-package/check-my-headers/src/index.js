const { isUrlValid, makeRequest } = require('./helpers')
const { setHeaders, setStatus, getAll, resetReport} = require('./report')
const { headerValidation } = require('./headerValidation')

const checkMyHeaders = async (url) => {
  if (!isUrlValid(url)) throw new Error('Invalid URL format!')
  const {ipAddress, serverHostname, headers, statusCode } = await makeRequest(url)

  setHeaders(headers)
  setStatus(statusCode)
  headerValidation(headers)

  const res = getAll()
  resetReport()

  res.ip = ipAddress;
  res.sh = serverHostname;

  return res;
}

module.exports = checkMyHeaders
