const {addUp, addArr, addError, addWarning, addInfo } = require('./report')
const { mandatory, optional, avoid, deprecated, upcoming } = require('./rules.json')

// Check for mandatory, avoid and deprecated ones.
const errorFields = (headers) => {
  const currentHeaders = Object.keys(headers)
  const mand_arr = []

  mandatory.filter(field => !currentHeaders.includes(field)).forEach(field => { mand_arr.push(field)})

  addArr({ text: "array", field: mand_arr });

  upcoming.filter(field => !currentHeaders.includes(field)).forEach(field => addUp({ text: "Missing", field }))

  avoid.filter(field => currentHeaders.includes(field)).forEach(field => addError({ text: "Remove", field }))
  mandatory.filter(field => !currentHeaders.includes(field)).forEach(field => addError({ text: "Missing", field }))





}

// Check for optional
const warningFields = (headers) => {
  const currentHeaders = Object.keys(headers)
  optional.filter(field => !currentHeaders.includes(field)).forEach(field => addWarning({ text: "optional",  field }))
  deprecated.filter(field => currentHeaders.includes(field)).forEach(field => addWarning({ text: "deprecated", field }))
}

// Check for extra headers
const infoFields = (headers) => {
  const allHeaders = [].concat(optional, mandatory, avoid, deprecated)
  const currentHeaders = Object.keys(headers)
  currentHeaders.filter(field => !allHeaders.includes(field)).forEach(field => addInfo({ text: "extra", field: field }))
}

const headerValidation = (headers = {}) => [errorFields, warningFields, infoFields].forEach(item => item(headers))

module.exports = { headerValidation, errorFields, warningFields, infoFields }
